<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Order Success</title>
<link rel="stylesheet" href="../css/LandingPage.css">
<link rel="stylesheet" href="../css/Checkout.css?v=7">
</head>
<body>
<nav id="navbar">
  <div class="nav-container">
    <div class="nav-left">
      <div class="logo">üèîÔ∏è TrailBlazer</div>
      <ul class="nav-links">
        <li><a href="landingPage.html">Home</a></li>
        <li><a href="ProductCatalogue.html">Gear</a></li>
        <li><a href="TrailsPage.html">Trails</a></li>
        <li><a href="GroupHikes.html">Community</a></li>
        <li><a href="AboutUsPage.html">About Us</a></li>
      </ul>
    </div>
    <div class="nav-actions">
      <div class="search-container">
        <input type="text" class="search-input" placeholder="Search gear, trails...">
        <button class="search-btn">üîç</button>
      </div>
      <div class="account-section">
        <a href="AdminPanel.html" class="account-btn" title="Admin Panel">‚öôÔ∏èAdmin</a>
        <a href="LoginPage.html" class="account-btn">üë§ Logout</a>
        <a href="Cart.html" class="cart-icon" aria-label="Cart">üõí <span class="cart-count" id="cart-count" data-cart-count>0</span></a>
      </div>
    </div>
  </div>
</nav>

<canvas id="confetti" class="confetti"></canvas>

<div class="container">
  <div class="success-hero">
    <span class="badge">Order placed</span>
    <h1>Thank you!</h1>
    <div id="success-total" class="kicker">Total R0.00</div>
    <div id="order-id" class="kicker">Order ID Loading...</div>
    <div class="row" style="gap:10px;margin-top:6px;justify-content:center">
      <a class="btn" href="./ProductCatalogue.html">Continue shopping</a>
      <a class="btn secondary" href="./GroupHikes.html">Find a group hike</a>
    </div>
  </div>

  <div class="grid" style="margin-top:10px">
    <div class="card"><h3>Items</h3><div id="success-items">Loading items...</div></div>
    <div class="card summary"><h3>Summary</h3><div id="success-summary">Loading summary...</div></div>
  </div>
</div>

<script>
console.log('Starting complete takeover script...');

window.Cart = {
  render: function() { console.log('Cart render blocked'); },
  add: function() {},
  remove: function() {},
  clear: function() {},
  get: function() { return []; },
  items: function() { return []; },
  count: function() { return 0; },
  totals: function() { return {subtotal:0,tax:0,total:0}; },
  loadLastOrder: function() { 
    try {
      return JSON.parse(localStorage.getItem('tb_last_order'));
    } catch (e) {
      return null;
    }
  }
};

function forceRender() {
  console.log('Force render starting...');
  
  const orderData = localStorage.getItem('tb_last_order');
  console.log('Order data:', orderData);
  
  if (!orderData) {
    console.error('No order data!');
    return;
  }
  
  let order;
  try {
    order = JSON.parse(orderData);
    console.log('Order parsed:', order);
  } catch (e) {
    console.error('Parse error:', e);
    return;
  }
  
  const totalEl = document.getElementById('success-total');
  const orderIdEl = document.getElementById('order-id');
  const itemsEl = document.getElementById('success-items');
  const summaryEl = document.getElementById('success-summary');
  
  console.log('Elements:', {
    total: !!totalEl,
    orderId: !!orderIdEl,
    items: !!itemsEl,
    summary: !!summaryEl
  });
  
  if (totalEl && order.totals) {
    totalEl.textContent = 'Total R' + order.totals.total.toFixed(2);
    console.log('Updated total to:', order.totals.total);
  }
  
  if (orderIdEl && order.id) {
    orderIdEl.textContent = 'Order ID ' + order.id;
    console.log('Updated order ID to:', order.id);
  }
  
  if (itemsEl && order.items) {
    itemsEl.innerHTML = '';
    order.items.forEach(item => {
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `
        <img src="${item.image || ''}" alt="" width="72" height="72">
        <div>
          <h4>${item.title || 'Item'}</h4>
          <div class="kicker">${item.brand || ''}</div>
        </div>
        <div class="price kicker">x${item.qty} ‚Ä¢ R${(item.price || 0).toFixed(2)}</div>
      `;
      itemsEl.appendChild(div);
    });
    console.log('Items rendered');
  }
  
  if (summaryEl && order.totals) {
    summaryEl.innerHTML = `
      <div class="line"><span>Subtotal</span><strong>R${order.totals.subtotal.toFixed(2)}</strong></div>
      <div class="line"><span>Discount</span><strong>-R${order.totals.discount.toFixed(2)}</strong></div>
      <div class="line"><span>Shipping</span><strong>R${order.totals.shipping.toFixed(2)}</strong></div>
      <div class="line"><span>Tax</span><strong>R${order.totals.tax.toFixed(2)}</strong></div>
      <div class="line total"><span>Total</span><strong>R${order.totals.total.toFixed(2)}</strong></div>
    `;
    console.log('Summary updated');
  }
  
  console.log('Force render complete');
}

forceRender();
setTimeout(forceRender, 50);
setTimeout(forceRender, 100);
setTimeout(forceRender, 200);
setTimeout(forceRender, 500);

document.addEventListener('DOMContentLoaded', forceRender);

console.log('Script setup complete');
</script>

<script>
(function(){
  var c=document.getElementById('confetti'); if(!c) return;
  var ctx=c.getContext('2d');
  function resize(){c.width=window.innerWidth;c.height=window.innerHeight}
  resize(); window.addEventListener('resize',resize);
  var colors=['#e67e22','#27ae60','#3498db','#f1c40f','#9b59b6','#e74c3c'];
  var pieces=Array.from({length:150},function(){return{
    x:Math.random()*c.width,
    y:-20-Math.random()*c.height,
    w:6+Math.random()*6,h:10+Math.random()*10,
    vy:2+Math.random()*3,vx:-2+Math.random()*4,
    rot:Math.random()*Math.PI*2,vr:-0.1+Math.random()*0.2,
    color:colors[(Math.random()*colors.length)|0]
  }});
  var start=Date.now(),duration=2500;
  function tick(){
    ctx.clearRect(0,0,c.width,c.height);
    for(var i=0;i<pieces.length;i++){
      var p=pieces[i];
      p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr;
      if(p.y>c.height+20){p.y=-20;p.x=Math.random()*c.width}
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.color; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h); ctx.restore();
    }
    if(Date.now()-start<duration) requestAnimationFrame(tick); else ctx.clearRect(0,0,c.width,c.height);
  }
  requestAnimationFrame(tick);
})();
</script>
</body>
</html>
